# TCP/IP网络通讯：TCPNetworkDemo4412

## 使开发板联网

为了保证实验进行，需要将iTop-4412开发板和实验用主机（自备）接入同一网段，并确保设备之间可以互相访问。由于没有配备无线模块，iTop-4412开发板仅支持使用有线方式联网。您可以考虑使用RJ45网线连接实验用主机和iTop-4412开发板，或将iTop-4412开发板以有线形式连接到本地路由器等。连接成功后，超级终端中会显示包含连接速度等的回显信息。

在开发板上执行指令“`ifconfig`”，回显显示的“`eth`”网络即为有线以太网（Ethernet），并且该网络的“`inet addr`”参数即为iTop-4412开发板当前的IPv4地址。

接下来，您同样需要知道您所使用的实验用主机的IPv4地址，您可以在实验用主机上以管理员身份启动Windows命令提示符或PowerShell（您通常可以在开始菜单或开始菜单的右键菜单中找到它们），执行“`ipconfig`”指令，即可得到“IPv4地址”数据。一般来说，如果您使用网线直接连接计算机和开发板，则“以太网”的IPv4地址通常是您需要的值。

您可以继续在该界面中执行“`ping X.X.X.X`”（“`X.X.X.X`”为前面获得的开发板的IPv4地址，即在开发板上执行指令“`ifconfig`”，回显显示的“`eth`”网络的“`inet addr`”参数的值），检查和开发板的通讯情况。

## 开启TCP/IP服务器

本实验目录“`Expr07-TCPIP`”的“`Windows`”文件夹中，有一个“`NetAssist.exe`”程序，在实验用计算机上启动该程序，即可打开“网络调试助手”工具。

之后，请进行配置，将“协议类型”设为“`TCP Server`”；“本地主机地址”选择先前记录的实验用主机的IPv4地址；“本地主机端口”可以自由配置，但是建议不要使用常见的`21`、`80`、`8080`等端口以避免冲突（推荐使用大于`1024`的数值，端口号不能高于`65535`）。之后，请点击“打开”按钮，启动本机的TCP服务器。

## 编译和执行TCP/IP客户端程序

启动虚拟机，并从Ubuntu桌面左侧的快速启动栏打开QtCreator，随后请点击QtCreator界面的“Open Project”按钮，打开“`~/iTop-4412-Expr/Expr07-TCPIP/ARM/TCPNetworkDemo4412/TCPNetworkDemo4412.pro`”文件。之后，请按“`Ctrl+B`”组合键，构建项目。

项目构建完成后，您应该能在“`~/QtProjects/build-TCPNetworkDemo4412-Qt_4_8_7-Release/`”目录中，找到“`TCPNetworkDemo4412`”文件。将一个已格式化为FAT32格式的U盘或SD卡插入计算机，并将该可执行文件传送到磁盘内。将磁盘插入开发板，超级终端中应该能看到设备挂载的回显内容。在超级终端中执行：

```
cd /mnt/sda1
./TCPNetworkDemo4412 HostIP Port
```

其中，“`HostIP`”为先前记录的实验用计算机的IPv4地址，即“网络调试助手”中显示的“本地主机地址”；“`Port`”为“网络调试助手”中显示的“本地主机端口”的值。

您应该能看到超级终端上出现提示网络连接成功的回显信息，且“网络调试助手”中出现了类似“`Client gets online`”的提示。

同时，开发板上也会出现一个“`MainWindow`”窗口，使用触摸屏点击该窗口下方的文本框，即可使用iTop-4412开发板自带的矩阵键盘输入内容，点击“`Send`”按钮即可将文本发送给实验用主机，同时实验用主机的“网络调试助手”即可收到文本。

在“网络调试助手”的“数据发送”文本框中输入内容，并点击“发送”按钮，开发板即可接收文本并显示。

点击“`Close`”按钮关闭程序，在超级终端中执行“`cd /`”命令并移除插入的磁盘，关闭“网络调试助手”并断开网络线缆连接，实验完毕。
